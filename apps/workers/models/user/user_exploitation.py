from django.db import models
from transliterate.utils import _

from apps.workers.models import UserBasic


class ExploitationManager(models.Manager):
    def create_user(self, phone, password, **extra_fields):
        if not phone:
            raise ValueError(_('Не указан телефонный номер.'))
        user = self.model(phone=phone, **extra_fields)
        user.set_password(password)
        user.save()
        return user

    def get_queryset(self, *args, **kwargs):
        return super().get_queryset(*args, **kwargs).filter(type=UserBasic.Types.EXPLOITATION)


class Exploitation(UserBasic):
    class Meta:
        proxy = True

    objects = ExploitationManager()

    def save(self, *args, **kwargs):
        self.type = UserBasic.Types.EXPLOITATION
        return super().save(*args, **kwargs)

    class Meta:
        verbose_name = 'Пользователь. Эксплуатация.'
        verbose_name_plural = 'Пользователи. Эксплуатация.'
        ordering = ['pk']
        default_permissions = ('')

        permissions = (
            ('UserExploitation_add', 'Пользователи. Эксплуатация. Добавить.'),
            ('UserExploitation_change', 'Пользователи. Эксплуатация. Редактировать.'),
            ('UserExploitation_delete', 'Пользователи. Эксплуатация. Удалить.'),
            ('UserExploitation_view', 'Пользователи. Эксплуатация. Просмотреть.'),
        )